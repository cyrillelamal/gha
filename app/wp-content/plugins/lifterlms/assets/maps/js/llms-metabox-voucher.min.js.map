{"version":3,"file":"../../js/llms-metabox-voucher.min.js","sources":["llms-metabox-voucher.js"],"sourcesContent":["(function( $ ){\n\n\tvar deleteIds = [];\n\n\t$( document ).ready(function () {\n\n\t\tvar changeNotSaved          = false;\n\t\tvar codesAddedSinceLastSave = 0;\n\n\t\t$( '#llms_voucher_add_codes' ).click(function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar qty  = $( '#llms_voucher_add_quantity' ).val();\n\t\t\tvar uses = $( '#llms_voucher_add_uses' ).val();\n\t\t\tvar html = '';\n\n\t\t\tchangeNotSaved = true;\n\n\t\t\tif ($.isNumeric( qty ) && $.isNumeric( uses )) {\n\t\t\t\tif (parseInt( qty ) > 0 && parseInt( uses ) > 0) {\n\n\t\t\t\t\tif (qty > 50) {\n\t\t\t\t\t\talert( \"You can only generate 50 rows at a time\" );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcodesAddedSinceLastSave += parseInt( qty );\n\n\t\t\t\t\tif (codesAddedSinceLastSave > 50) {\n\t\t\t\t\t\talert( \"Please save before adding any more codes, limit is 50 at a time\" );\n\t\t\t\t\t\tcodesAddedSinceLastSave -= parseInt( qty );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var i = 1; i <= parseInt( qty ); i++) {\n\t\t\t\t\t\thtml += '<tr>' +\n\t\t\t\t\t\t\t'<td></td>' +\n\t\t\t\t\t\t\t'<td>' +\n\t\t\t\t\t\t\t'<input type=\"text\" maxlength=\"20\" placeholder=\"Code\" value=\"' + randomizeCode() + '\" name=\"llms_voucher_code[]\">' +\n\t\t\t\t\t\t\t'<input type=\"hidden\" name=\"llms_voucher_code_id[]\" value=\"0\">' +\n\t\t\t\t\t\t\t'</td>' +\n\t\t\t\t\t\t\t'<td><span>0 / </span><input type=\"text\" placeholder=\"Uses\" value=\"' + uses + '\" class=\"llms-voucher-uses\" name=\"llms_voucher_uses[]\"></td>' +\n\t\t\t\t\t\t\t'<td><a href=\"#\" class=\"llms-voucher-delete\">' + delete_icon + '</a></td>' +\n\t\t\t\t\t\t\t'</tr>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$( '#llms_voucher_tbody' ).append( html );\n\n\t\t\tbindDeleteVoucherCode();\n\t\t});\n\n\t\tbindDeleteVoucherCode();\n\n\t\t$( '#llms_voucher_tbody input' ).change(function() {\n\t\t\tchangeNotSaved = true;\n\t\t});\n\n\t\t$( \"#post\" ).on( 'submit', function() {\n\t\t\tif ($( '#publish' ).attr( 'name' ) === 'publish') {\n\t\t\t\t$( '<input />' ).attr( 'type', 'hidden' )\n\t\t\t\t\t.attr( 'name', \"publish\" )\n\t\t\t\t\t.attr( 'value', \"true\" )\n\t\t\t\t\t.appendTo( '#post' );\n\t\t\t}\n\t\t\treturn true;\n\t\t} );\n\n\t\twindow.onbeforeunload = function() {\n\t\t\treturn changeNotSaved ? \"If you leave this page you will lose your unsaved changes.\" : null;\n\t\t};\n\n\t\t$( 'input[type=submit][name=save]' ).click(function (e) {\n\t\t\tvar unique_values = {};\n\t\t\tvar duplicate     = false;\n\t\t\t$( 'input[name=\"llms_voucher_code[]\"]' ).each(function() {\n\t\t\t\tvar val = $( this ).val()\n\t\t\t\tif ( ! unique_values[val] ) {\n\t\t\t\t\tunique_values[val] = true;\n\t\t\t\t} else {\n\t\t\t\t\t$( this ).css( 'background-color', 'rgba(226, 96, 73, 0.6)' );\n\t\t\t\t\tduplicate = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (duplicate) {\n\t\t\t\talert( 'Please make sure that there are no duplicate voucher codes.' );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// If course or membership is not selected, don't allow user to save.\n\t\t\tif ( ! $( '#_llms_voucher_courses' ).val().length && ! $( '#_llms_voucher_membership' ).val().length ) {\n\t\t\t\talert( 'Please select course or membership before saving.' );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tchangeNotSaved = false;\n\t\t\tcheck_voucher_duplicate();\n\t\t\treturn false;\n\t\t});\n\n\t\tfunction bindDeleteVoucherCode() {\n\t\t\t$( '.llms-voucher-delete' ).unbind( 'click' );\n\t\t\t$( '.llms-voucher-delete' ).click(function (e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar t   = $( this );\n\t\t\t\tvar old = t.data( 'id' );\n\n\t\t\t\tchangeNotSaved = true;\n\n\t\t\t\tif (old) {\n\t\t\t\t\tdeleteIds.push( old );\n\n\t\t\t\t\t$( '#delete_ids' ).val( deleteIds.join( ',' ) );\n\t\t\t\t} else {\n\t\t\t\t\tcodesAddedSinceLastSave--;\n\t\t\t\t}\n\n\t\t\t\t// remove html block\n\t\t\t\tt.closest( 'tr' ).remove();\n\t\t\t});\n\t\t}\n\t});\n\tfunction randomizeCode() {\n\t\tvar text     = '';\n\t\tvar possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n\t\tfor (var i = 0; i < 12; i++) {\n\t\t\ttext += possible.charAt( Math.floor( Math.random() * possible.length ) );\n\t\t}\n\n\t\treturn text;\n\t}\n\n\t/**\n\t * Check for voucher duplicates in other posts.\n\t *\n\t * @since Unknown\n\t * @since 5.9.0 Add nonce.\n\t *\n\t * @return {void}\n\t */\n\tfunction check_voucher_duplicate() {\n\n\t\tvar data = {\n\t\t\taction: 'check_voucher_duplicate', 'postId' :\n\t\t\tjQuery( '#post_ID' ).val(),\n\t\t\t'codes' :  get_codes_from_inputs(),\n\t\t\t_ajax_nonce: window.llms.ajax_nonce,\n\t\t};\n\n\t\tvar ajax = new Ajax( 'post', data, false );\n\t\tajax.check_voucher_duplicate();\n\t}\n\n\tfunction get_codes_from_inputs() {\n\t\tvar codes = [];\n\t\t$( 'input[name=\"llms_voucher_code[]\"]' ).each(function() {\n\t\t\tcodes.push( $( this ).val() );\n\t\t});\n\n\t\treturn codes;\n\t}\n\n})( jQuery );\n\nfunction llms_on_voucher_duplicate (results) {\n\tif (results.length) {\n\t\tfor (var i = 0; i < results.length; i++ ) {\n\t\t\tjQuery( 'input[value=\"' + results[i].code + '\"]' ).css( 'background-color', 'rgba(226, 96, 73, 0.6)' );\n\t\t}\n\t\talert( 'Please make sure that there are no duplicate voucher codes.' );\n\t} else {\n\t\tjQuery( \"#post\" ).submit();\n\t}\n}\n"],"names":["llms_on_voucher_duplicate","results","length","i","jQuery","code","css","alert","submit","$","deleteIds","document","ready","changeNotSaved","codesAddedSinceLastSave","bindDeleteVoucherCode","unbind","click","e","preventDefault","t","this","old","data","push","val","join","closest","remove","qty","uses","html","isNumeric","parseInt","text","possible","charAt","Math","floor","random","randomizeCode","delete_icon","append","change","on","attr","appendTo","window","onbeforeunload","unique_values","duplicate","each","action","postId","codes","get_codes_from_inputs","_ajax_nonce","llms","ajax_nonce","Ajax","check_voucher_duplicate"],"mappings":"AAuKA,SAASA,0BAA2BC,GACnC,GAAIA,EAAQC,OAAQ,CACnB,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAQC,OAAQC,IACnCC,OAAQ,gBAAkBH,EAAQE,GAAGE,KAAO,MAAOC,IAAK,mBAAoB,0BAE7EC,MAAO,oEAEPH,OAAQ,SAAUI,UA9KpB,SAAWC,GAEV,IAAIC,EAAY,GAEhBD,EAAGE,UAAWC,MAAM,WAEnB,IAAIC,GAA0B,EAC1BC,EAA0B,EA8F9B,SAASC,IACRN,EAAG,wBAAyBO,OAAQ,SACpCP,EAAG,wBAAyBQ,MAAM,SAAUC,GAC3CA,EAAEC,iBAEF,IAAIC,EAAMX,EAAGY,MACTC,EAAMF,EAAEG,KAAM,MAElBV,GAAiB,EAEbS,GACHZ,EAAUc,KAAMF,GAEhBb,EAAG,eAAgBgB,IAAKf,EAAUgB,KAAM,OAExCZ,IAIDM,EAAEO,QAAS,MAAOC,WA/GpBnB,EAAG,2BAA4BQ,MAAM,SAAUC,GAC9CA,EAAEC,iBAEF,IAAIU,EAAOpB,EAAG,8BAA+BgB,MACzCK,EAAOrB,EAAG,0BAA2BgB,MACrCM,EAAO,GAIX,GAFAlB,GAAiB,EAEbJ,EAAEuB,UAAWH,IAASpB,EAAEuB,UAAWF,IAChB,EAAlBG,SAAUJ,IAAgC,EAAnBI,SAAUH,GAAY,CAEhD,GAAU,GAAND,EAEH,YADAtB,MAAO,2CAMR,GAA8B,IAF9BO,GAA2BmB,SAAUJ,IAKpC,OAFAtB,MAAO,wEACPO,GAA2BmB,SAAUJ,IAItC,IAAK,IAAI1B,EAAI,EAAGA,GAAK8B,SAAUJ,GAAO1B,IACrC4B,GAAQ,gFAyFb,WAIC,IAHA,IAAIG,EAAW,GACXC,EAAW,iEAENhC,EAAI,EAAGA,EAAI,GAAIA,IACvB+B,GAAQC,EAASC,OAAQC,KAAKC,MAAOD,KAAKE,SAAWJ,EAASjC,SAG/D,OAAOgC,EA9F+DM,GAAkB,oKAGZV,EAAO,2GAC7BW,YAAc,iBAMnEhC,EAAG,uBAAwBiC,OAAQX,GAEnChB,MAGDA,IAEAN,EAAG,6BAA8BkC,OAAO,WACvC9B,GAAiB,IAGlBJ,EAAG,SAAUmC,GAAI,SAAU,WAO1B,MANuC,YAAnCnC,EAAG,YAAaoC,KAAM,SACzBpC,EAAG,aAAcoC,KAAM,OAAQ,UAC7BA,KAAM,OAAQ,WACdA,KAAM,QAAS,QACfC,SAAU,UAEN,IAGRC,OAAOC,eAAiB,WACvB,OAAOnC,EAAiB,6DAA+D,MAGxFJ,EAAG,iCAAkCQ,MAAM,SAAUC,GACpD,IAuEGK,EAvEC0B,EAAgB,GAChBC,GAAgB,EAUpB,OATAzC,EAAG,qCAAsC0C,KAAK,WAC7C,IAAI1B,EAAMhB,EAAGY,MAAOI,MACbwB,EAAcxB,IAGpBhB,EAAGY,MAAOf,IAAK,mBAAoB,0BACnC4C,GAAY,GAHZD,EAAcxB,IAAO,IAMnByB,EACH3C,MAAO,+DAKDE,EAAG,0BAA2BgB,MAAMvB,QAAYO,EAAG,6BAA8BgB,MAAMvB,QAK9FW,GAAiB,EAiDdU,EAAO,CACV6B,OAAQ,0BAA2BC,OACnCjD,OAAQ,YAAaqB,MACrB6B,MAQF,WACC,IAAIA,EAAQ,GAKZ,OAJA7C,EAAG,qCAAsC0C,KAAK,WAC7CG,EAAM9B,KAAMf,EAAGY,MAAOI,SAGhB6B,EAdKC,GACXC,YAAaT,OAAOU,KAAKC,YAGf,IAAIC,KAAM,OAAQpC,GAAM,GAC9BqC,2BA7DHrD,MAAO,sDALA,MAvFX,CAqKIH","sourceRoot":"../../js"}